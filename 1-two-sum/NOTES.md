Noticed this algorithm could use some refactoring.
